{"driver": "//############################################################################################\r\n\r\n/* Title: Embedded Coordinator peripheral driver\r\nSee also: <https://www.iqrf.org/DpaTechGuide/>\r\n*/\r\n\r\n/*DriverDescription\r\n{ 'ID' : 0x00,\r\n  'Type' : 'Standard',\r\n  'Internal' : false,\r\n  'Versions' : [\r\n    { 'Version' : 2.00, 'VersionFlags' : 1, 'Notes' : [\r\n        'Changes for DPA 4.00',\r\n        'Discarded functions for DPA commands CMD_COORDINATOR_READ_REMOTELY_BONDED_MID, CMD_COORDINATOR_CLEAR_REMOTELY_BONDED_MID, CMD_COORDINATOR_ENABLE_REMOTE_BONDING, CMD_COORDINATOR_REBOND_NODE, CMD_COORDINATOR_DISCOVERY_DATA, and CMD_NODE_REMOVE_BOND_ADDRESS.',\r\n        'Parameter bondingMask at BondNode_Request renamed to bondingTestRetries.'\r\n        ]\r\n    },    \r\n    { 'Version' : 1.00, 'VersionFlags' : 1, 'Notes' : [\r\n        'Added SmartConnect support for DPA > 3.02.',\r\n        'DiscoveredDevices_Response and BondedDevices_Response ignore addresses above 239.',\r\n        'Added SetMID.'\r\n        ]\r\n    },\r\n    { 'Version' : 0.00, 'Notes' : [\r\n        'Initial release',\r\n        ]\r\n    }\r\n  ] }\r\nDriverDescription*/\r\n\r\n\"use strict\";\r\n// Namespace: iqrf.embed.coordinator\r\n// All prepared DPA requests have nadr set to '00'.\r\nnamespace( 'iqrf.embed.coordinator' );\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.AddrInfo_Request\r\nEncodes DPA request to get basic network information.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.AddrInfo_Request = function ()\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '00' );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.AddrInfo_Response\r\nDecodes DPA response from getting basic network information.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  object: Object with the following fields (see DPA documentation https://www.iqrf.org/DpaTechGuide for details):\r\n\r\n* devNr - number: \r\n* did - number: \r\n*/\r\niqrf.embed.coordinator.AddrInfo_Response = function ( response )\r\n{\r\n  var responseData = iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '80', 2 );\r\n\r\n  var result =\r\n  {\r\n    devNr: responseData[0],\r\n    did: responseData[1]\r\n  };\r\n\r\n  return result;\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.DiscoveredDevices_Request\r\nEncodes DPA request to get list of discovered devices\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.DiscoveredDevices_Request = function ()\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '01' );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.DiscoveredDevices_Response\r\nDecodes DPA response from getting list of discovered devices.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  array: Array if integer values corresponding to the addresses of the discovered devices.\r\n*/\r\niqrf.embed.coordinator.DiscoveredDevices_Response = function ( response )\r\n{\r\n  return iqrf.BitmapToIndexes( iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '81', 32 ), 0, 29 );\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.BondedDevices_Request\r\nEncodes DPA request to get list of bonded devices\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.BondedDevices_Request = function ()\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '02' );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.BondedDevices_Response\r\nDecodes DPA response from getting list of bonded devices.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  array: Array if integer values corresponding to the addresses of the bonded devices.\r\n*/\r\niqrf.embed.coordinator.BondedDevices_Response = function ( response )\r\n{\r\n  return iqrf.BitmapToIndexes( iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '82', 32 ), 0, 29 );\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.ClearAllBonds_Request\r\nEncodes DPA request to clear all bonds.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.ClearAllBonds_Request = function ()\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '03' );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.ClearAllBonds_Response\r\nDecodes DPA response from clearing all bonds.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n*/\r\niqrf.embed.coordinator.ClearAllBonds_Response = function ( response )\r\n{\r\n  iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '83', 0 );\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.BondNode_Request\r\nEncodes DPA request to bond a node.\r\n\r\nParameters:\r\n  reqAddr - number: Requested address.\r\n  bondingTestRetries - number: Bonding mask.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.BondNode_Request = function ( reqAddr, bondingTestRetries )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '04', iqrf.ToHexStringByte( reqAddr ) + '.' + iqrf.ToHexStringByte( bondingTestRetries ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.BondNode_Response\r\nDecodes DPA response from bonding a node.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  object: Object with the following fields:\r\n\r\n* bondAddr - number: Address of the node newly bonded to the network.\r\n* devNr - number: Number of bonded network nodes.\r\n*/\r\niqrf.embed.coordinator.BondNode_Response = function ( response )\r\n{\r\n  var responseData = iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '84', 2 );\r\n\r\n  var result =\r\n  {\r\n    bondAddr: responseData[0],\r\n    devNr: responseData[1]\r\n  };\r\n\r\n  return result;\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.RemoveBond_Request\r\nEncodes DPA request to remove bond.\r\n\r\nParameters:\r\n  bondAddr - number: Address of the node to remove the bond to.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.RemoveBond_Request = function ( bondAddr )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '05', iqrf.ToHexStringByte( bondAddr ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.RemoveBond_Response\r\nDecodes DPA response from removing bond.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  number: Number of bonded network nodes.\r\n*/\r\niqrf.embed.coordinator.RemoveBond_Response = function ( response )\r\n{\r\n  var responseData = iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '85', 1 );\r\n  return responseData[0];\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.Discovery_Request\r\nEncodes DPA request to run discovery.\r\n\r\nParameters:\r\n  txPower - number: TX Power used for discovery. \r\n  maxAddr - number: Nonzero value specifies maximum node address to be part of the discovery process. \r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.Discovery_Request = function ( txPower, maxAddr )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '07', iqrf.ToHexStringByte( txPower ) + '.' + iqrf.ToHexStringByte( maxAddr ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.Discovery_Response\r\nDecodes DPA response from running discovery.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  number: Number of discovered network nodes.\r\n*/\r\niqrf.embed.coordinator.Discovery_Response = function ( response )\r\n{\r\n  var responseData = iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '87', 1 );\r\n  return responseData[0];\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.SetDpaParams_Request\r\nEncodes DPA request to set DPA parameter.\r\n\r\nParameters:\r\n  dpaParam - number: DPA param to set.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.SetDpaParams_Request = function ( dpaParam )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '08', iqrf.ToHexStringByte( dpaParam ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.SetDpaParams_Response\r\nDecodes DPA response from setting DPA parameter.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  number: Previous DPA parameter value.\r\n*/\r\niqrf.embed.coordinator.SetDpaParams_Response = function ( response )\r\n{\r\n  var responseData = iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '88', 1 );\r\n  return responseData[0];\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.SetHops_Request\r\nEncodes DPA request to specify number of hops\r\n\r\nParameters:\r\n  requestHops - number: see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n  responseHops - number: see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.SetHops_Request = function ( requestHops, responseHops )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '09', iqrf.ToHexStringByte( requestHops ) + '.' + iqrf.ToHexStringByte( responseHops ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.SetHops_Response\r\nDecodes DPA response from specifying number of hops.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\nobject: Object with the following fields storing previous values:\r\n\r\n* requestHops - number: \r\n* responseHops - number: \r\n*/\r\niqrf.embed.coordinator.SetHops_Response = function ( response )\r\n{\r\n  var responseData = iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '89', 2 );\r\n\r\n  var result =\r\n  {\r\n    requestHops: responseData[0],\r\n    responseHops: responseData[1]\r\n  };\r\n\r\n  return result;\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.Backup_Request\r\nEncodes DPA request to backup coordinator.\r\n\r\nParameters:\r\n  index - number: Index of the block of data.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.Backup_Request = function ( index )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '0B', iqrf.ToHexStringByte( index ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.Backup_Response\r\nDecodes DPA response from backing up coordinator.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  array: Array of bytes with the backup content.\r\n*/\r\niqrf.embed.coordinator.Backup_Response = function ( response )\r\n{\r\n  return iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '8B', 49 );\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.Restore_Request\r\nEncodes DPA request to restore coordinator.\r\n\r\nParameters:\r\n  networkData - array: One block of the coordinator network info data previously obtained by a backup command.  \r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.Restore_Request = function ( networkData )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '0C', iqrf.BytesToHexStringBytesArray( networkData ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.Restore_Response\r\nDecodes DPA response from restoring coordinator.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n*/\r\niqrf.embed.coordinator.Restore_Response = function ( response )\r\n{\r\n  iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '8C', 0 );\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.AuthorizeBond_Request\r\nEncodes DPA request to authorize previously remotely pre-bonded node.\r\n\r\nParameters:\r\n  reqAddr - number: see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n  mid - number: see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.AuthorizeBond_Request = function ( reqAddr, mid )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '0D', iqrf.ToHexStringByte( reqAddr ) + '.' + iqrf.IntToHexStringBytesArray( mid, 4 ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.AuthorizeBond_Response\r\nDecodes DPA response from authorizing previously remotely pre-bonded node.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  object: Object with the following fields:\r\n\r\n* bondAddr - number: Address of the node newly bonded to the network.\r\n* devNr - number: Number of bonded network nodes.\r\n*/\r\niqrf.embed.coordinator.AuthorizeBond_Response = function ( response )\r\n{\r\n  var responseData = iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '8D', 2 );\r\n\r\n  var result =\r\n  {\r\n    bondAddr: responseData[0],\r\n    devNr: responseData[1]\r\n  };\r\n\r\n  return result;\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.SmartConnect_Request\r\nEncodes DPA request for Smart Connect.\r\nFrom version 1.00 for DPA > 3.02.\r\n\r\nParameters:\r\n  reqAddr - number: see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n  bondingTestRetries - number: see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n  ibk - array: see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n  mid - number: see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n  virtualDeviceAddress - number: see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n  userData - array:  see DPA documentation https://www.iqrf.org/DpaTechGuide for details.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\n\r\niqrf.embed.coordinator.SmartConnect_Request = function ( reqAddr, bondingTestRetries, ibk, mid, virtualDeviceAddress, userData )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '12',\r\n    iqrf.ToHexStringByte( reqAddr ) + '.' +\r\n    iqrf.ToHexStringByte( bondingTestRetries ) + '.' +\r\n    iqrf.BytesToHexStringBytesArray( ibk ) + '.' +\r\n    iqrf.IntToHexStringBytesArray( mid, 4 ) + '.00.00.' +\r\n    iqrf.ToHexStringByte( virtualDeviceAddress ) + '.00.00.00.00.00.00.00.00.00.' +\r\n    iqrf.BytesToHexStringBytesArray( userData ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.SmartConnect_Response\r\nDecodes DPA response from Smart Connect.\r\nFrom version 1.00 for DPA > 3.02.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n\r\nReturns:\r\n  object: Object with the following fields:\r\n\r\n* bondAddr - number: Address of the node newly bonded to the network.\r\n* devNr - number: Number of bonded network nodes.\r\n*/\r\niqrf.embed.coordinator.SmartConnect_Response = function ( response )\r\n{\r\n  var responseData = iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '92', 2 );\r\n\r\n  var result =\r\n  {\r\n    bondAddr: responseData[0],\r\n    devNr: responseData[1]\r\n  };\r\n\r\n  return result;\r\n};\r\n\r\n// --------------\r\n/* Function: iqrf.embed.coordinator.SetMID_Request\r\nEncodes DPA request to set the MID.\r\nFrom version 1.00 for DPA > 3.02.\r\n\r\nParameters:\r\n  bondAddr - number: Address of the node.\r\n  mid - number: MID to write to the Coordinator's database.\r\n\r\nReturns:\r\n  iqrf.DpaRawHdpMessage: DPA request object.\r\n*/\r\niqrf.embed.coordinator.SetMID_Request = function ( bondAddr, mid )\r\n{\r\n  return new iqrf.DpaRawHdpMessageCoordinator( iqrf.PNUM_Coordinator, '13', iqrf.IntToHexStringBytesArray( mid, 4 ) + '.' + iqrf.ToHexStringByte( bondAddr ) );\r\n};\r\n\r\n/* Function: iqrf.embed.coordinator.SetMID_Response\r\nDecodes DPA response from setting the MID.\r\nFrom version 1.00 for DPA > 3.02.\r\n\r\nParameters:\r\n  response - iqrf.DpaRawHdpMessage: DPA response object.\r\n*/\r\niqrf.embed.coordinator.SetMID_Response = function ( response )\r\n{\r\n  iqrf.CheckResponsePnumPcmdDlen( response, iqrf.PNUM_Coordinator, '93', 0 );\r\n};\r\n\r\n//############################################################################################\r\n", "name": "Embed: Coordinator", "notes": "Changes for DPA 4.00\nDiscarded functions for DPA commands CMD_COORDINATOR_READ_REMOTELY_BONDED_MID, CMD_COORDINATOR_CLEAR_REMOTELY_BONDED_MID, CMD_COORDINATOR_ENABLE_REMOTE_BONDING, CMD_COORDINATOR_REBOND_NODE, CMD_COORDINATOR_DISCOVERY_DATA, and CMD_NODE_REMOVE_BOND_ADDRESS.\nParameter bondingMask at BondNode_Request renamed to bondingTestRetries.", "standardID": 0, "version": 2.0, "versionFlags": 1}